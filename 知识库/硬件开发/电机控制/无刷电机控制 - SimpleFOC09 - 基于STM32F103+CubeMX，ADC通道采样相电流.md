# 导言
---
开始移植SimpleFOC的电流环代码之前，先实现ADC通道采样相电流的功能。








# 三、细节补充
----
## 3.1、ADC采样时间与转换时间
### 3.1.1、ADC采样时间
来自bilibili：《[[STM32 HAL库][ADC]采样时间和转换时间，最佳教程，没有之一](https://www.bilibili.com/video/BV1XM4m1y7eP/?spm_id_from=333.1391.0.0&vd_source=5a3da2d3c2504fa7535978c724745a9e)》的视频6：45分。
![[Pasted image 20250120174234.png]]
![[Pasted image 20250120174418.png]]
![[Pasted image 20250120174601.png]]
![[Pasted image 20250120174734.png]]
所谓采样时间，就是开关闭合，让模拟信号跑进电容Cadc，接着再断开开关，这个流程的时间。

### 3.1.2、采样时间怎样计算?
![[Pasted image 20250120175057.png]]
其中Radc=1k是MCU的内阻，它是固定的。电容Cadc也是固定的8pF。MCU外部的电阻有锂电池的内阻 + 电机相电阻 + 导线电阻等等。
![[Pasted image 20250120175416.png]]
如上图所示，博主计算了一番：
- 当MCU外面的电阻 = 400欧姆时，如果ADC运行频率 = 14MHz时，那么采样时间至少 = 1.54cycles
- 当MCU外面的电阻 = 10k欧姆时，如果ADC运算频率 = 14MHz时，那么采样时间至少 = 11.9cycles

>一般锂电池的电芯都是m欧姆级别，电机的相电阻一般也才几个欧姆，导线的电阻也很低。所示，就算我们当400欧姆来计算，1.54cycles也有一定的冗余。大部分的人都建议至少用7.5 cycles。
>如果ADC频率是12MHz，采样时间等于0.625us。1 / 12MHz = 83.3333ns、7.5 cycles * 83.333ns = 0.625us。

### 3.1.3、转换时间
![[Pasted image 20250120180154.png | 1100]]
如上所示，STM32F103的中文参考手册的161页有说明，转换时间是固定的12.5cycle。
>注：如果ADC的运算频率是12MHz，转换时间等于1.0417us。 1 / 12MHz = 83.333ns、12.5cycle * 83.333ns = 1.0317us。

