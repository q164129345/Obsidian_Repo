# 导言
---
上一章节《[[无刷电机控制 - SimpleFOC05 - 基于STM32F103+CubeMX，实现速度开环控制]]》完成三相无刷电机的开环速度控制。接下来，开始调试编码器（位置传感器）。为接下来的位置闭环控制，速度闭环控制做准备。

### RTT_Viewer
![[Pasted image 20250108120717.png]]

### 编码器校准的动作
![[飞书20250108-121114.mp4]]

# 一、校准编码器的目的
---
![[Pasted image 20250107211108.png]]
**校准编码器的目的是确定编码器的方向direction与计算出偏移角度offset。** 编码器输出的方向可能与电机的旋转方向不一致，它们之间的方向关系是1或者-1。校准方向一次只需要进行一次，同一个电机与编码器只需要校准一次，后续就可以写死在程序里。编码器安装在电机轴上时，可能由于安装的角度误差，导致编码器与电机转子之间产生固定的角度偏移，它就是偏移角offset。理论上来说，这个偏移角等于0。每一个电机与编码器的组合都要校准一遍，因为每一个的安装公差都不一样。校准之后，可以将偏移角保存在Flash里，程序初始化时，从flash里读取出来。

# 二、代码
---
## 2.1、user_main.cpp
![[Pasted image 20250108165016.png]]
如上图所示，增加三句代码后，运行代码`motor_initFOC()`的时候会执行编码器的校准，最终的到编码器方向CCW与编码器偏移角2.2152。
![[Pasted image 20250108165547.png]]
如上所示，编译代码成功，下载到开发板即可。

# 三、细节补充
---
## 3.1、motor.initFOC()执行编码器校准的流程
![[Pasted image 20250108170442.png]]
![[Pasted image 20250108171806.png]]
![[Pasted image 20250108172147.png]]
如上所示，simpleFOC校准编码器的代码真的很简单。

## 3.2、






