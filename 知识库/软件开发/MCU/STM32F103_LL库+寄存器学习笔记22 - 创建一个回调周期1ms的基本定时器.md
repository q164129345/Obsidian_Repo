# 导言
---
![[Pasted image 20250512192708.png]]
如上所示，STM32F103有两个基本定时器TIM6与TIM7，所谓基本定时器就是功能最简单的定时器。


# 一、LL库
---
## 1.1、CubeMX
![[Pasted image 20250512194649.png | 1000]]
如上所示，STM32F103的Timer时钟频率都是72M。

![[Pasted image 20250512195212.png | 1000]]
![[Pasted image 20250512194542.png | 1000]]
![[Pasted image 20250512194608.png | 1000]]

## 1.2、tim.c
![[Pasted image 20250512201816.png | 1000]]
CubeMX根据刚才的设置，自动生成了代码。

## 1.3、main.c
![[Pasted image 20250512202008.png | 1000]]

## 1.4、stm32f1xx_it.c
![[Pasted image 20250512204855.png | 1000]]

## 1.5、编译、调试
![[Pasted image 20250512202240.png | 1000]]
![[22_Basic_Timer.gif | 1000]]
如上所示，串口疯狂打印“Hello,World\n"。

# 二、寄存器方式
---
## 2.1、myTIM6Drive.c
![[Pasted image 20250512204527.png | 1000]]
![[Pasted image 20250512204958.png | 1000]]
如上所示，寄存器的代码真简洁。

## 2.2、编译、调试
![[Pasted image 20250512205126.png | 1000]]
![[22_Basic_Timer_Reg.gif | 1000]]
代码的效果一样。

# 三、相关的TIM寄存器
---
## 3.1、RCC_APB1ENR时钟使能寄存器
![[Pasted image 20250513101715.png]]
```c
RCC->APB1ENR |= RCC_APB1ENR_TIM6EN; // 使能 TIM6 时钟
```

## 3.2、TIMx_PSC预分配寄存器
![[Pasted image 20250513102126.png]]
```c
TIM6->PSC = 71;      /* PSC 寄存器：计数时钟 = PCLK1/(PSC+1) */
```

## 3.3、TIMx_ARR自动重载寄存器
![[Pasted image 20250513102246.png]]
```c
TIM6->ARR = 999;     /* ARR 寄存器：计数到 ARR 后产生更新事件 */
```

## 3.4、TIMx_CR1控制寄存器1
![[Pasted image 20250513102447.png]]
```c
TIM6->CR1 |= TIM_CR1_ARPE; /* 3. 使能 ARR 预装载 */

TIM6->CR1 |= TIM_CR1_CEN;  /* 4. 启动定时器 */
```

## 3.5、TIMx_SR状态寄存器
![[Pasted image 20250513103105.png]]
```c
TIM6->SR &= ~TIM_SR_UIF; /* 1. 清除更新中断标志 */
```
在全局中断回调里，如果是UIF中断的话，需要及时写0清掉UIF中断标志。
`TIM_SR_UIF` 定义为 0x0001（即 bit-0）。所以，`~TIM_SR_UIF` 等于 `0xFFFE`。把 UIF 位对应的位置为 0，其它位为 1。最终，`SR &= 0xFFFE` 就是“给 UIF 写 0，给其它位写 1”——符合“写 0 清”语义。

## 3.6、TIMx_DIER中断使能寄存器
![[Pasted image 20250513103728.png]]
如上所示，UIE位置1使能TIMx的更新中断（计数溢出）。
```c
TIM6->DIER |= TIM_DIER_UIE; // 使能更新中断
```

# 四、细节补充
---

















