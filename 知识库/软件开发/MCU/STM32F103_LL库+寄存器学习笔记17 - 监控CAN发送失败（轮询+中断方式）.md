# 导言
---
《[[STM32F103_LL库+寄存器学习笔记16 - 监控CAN发送失败（轮询方式）]]》完成用轮询的方式去监控CAN的错误状态。

在CAN通信中，轮询和中断方式检测错误状态各有其适用场景和优缺点：
1. **轮询方式（Polling）的优点：**
- 实现简单。无需配置中断向量，直接在主循环中定期检查错误寄存器即可。
```c
while (1) {
    /* 监控CAN错误 */
    if (CAN_Check_Error() == 0x03) { // 因为错误太严重，进入离线状态
        g_BusOffCount++;      // 每发生一次busoff严重错误，记录一次
        CAN_BusOff_Recover(); // 离线状态恢复
    } else {
        // 其他错误与没有错误
    }
    HAL_Delay(1); // 1ms轮询间隔
}
```
- 确定性高，错误检测的时机由主循环控制，适合对实时性要求不严格的场景。
- 无中断开销，节省中断上下文切换的时间（约20-50个CPU周期）。
**缺点**：
- 实时性差，错误从发生到被检测的延迟取决于轮询间隔（如10ms轮询时，最大延迟10ms）。
- CPU资源浪费，高频轮询（如1ms）会占用大量CPU时间，低频率则可能错过瞬时错误。

2. **中断方式的优点：**
- 实时快速响应。当错误发生时，中断可以立即触发 ISR，实现快速响应，特别适合对时延要求严格的应用场景。
- 提高 CPU 利用率。在平时（错误没有发生时），CPU 可以处于低功耗模式或者执行其他任务，中断仅在需要处理异常时才介入，整体上提高了系统资源的利用率。
**缺点**：
- 实现复杂度增加。中断处理需要综合考虑中断优先级、数据一致性、上下文切换以及可能的嵌套中断等问题，开发和调试的难度相对较大。
- 上下文切换开销。每一次中断都会引起一定的上下文保存与恢复开销，若错误频繁发生，中断响应及中断处理代码可能对系统性能产生较大影响。


# 一、混合方式（轮询+中断）
---
- 轮询方式适用于：
	- 对实时性要求较低的系统。
	- 错误发生频率低、系统负载较轻的应用。
	- 开发周期紧张、期望简化逻辑和降低调试难度的场景。
- 中断方式适用于：
	- 对错误响应要求较高，需要快速捕捉和处理异常的系统。
	- 系统负载较大，且希望在错误发生时立即调度其他关键任务。
	- 有经验处理复杂中断及优先级调度的开发团队，可以较好地控制中断带来的潜在问题。
在实际设计中，使用混合方式是一个非常不错的选择：使用中断来快速捕获错误信号，再在主循环中做进一步处理。这样既能保证实时响应，也能减轻中断服务程序的复杂性，确保错误处理的完整性。






