
# 导言
---
![[Pasted image 20250418134814.png]]
如上所示，在[[STM32F103_HAL库+寄存器学习笔记19 - CAN发送中断+CAN接收中断+接收所有CAN报文+ringbuffer数据结构]]的基础上，为CAN发送也安排上强大的ringbuffer（环形缓冲区）。CAN发送有三个发送邮箱，为什么还另外需要ringbuffer？
1. **三邮箱限制**：STM32F103 的 CAN 控制器只有三个发送邮箱，当应用层短时间内产生超过 3 条待发帧时，多余的帧就无法立即写入邮箱，会被丢弃或需要阻塞（阻塞相对来说更可靠一些，但是会阻塞！）。
2. **突发流量平滑**：环形缓冲区可以暂存超出邮箱数的那些帧，在邮箱空闲时再依次发送，避免丢帧。
3. **解耦业务与硬件**：应用层只需往环形缓冲区写入数据，不用关心底层邮箱是否空闲，降低了发送接口的耦合度。








